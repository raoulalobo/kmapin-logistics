//////////////////////////////////////////////////////////////////////////////////////////////
// DO NOT MODIFY THIS FILE                                                                  //
// This file is automatically generated by ZenStack CLI and should not be manually updated. //
//////////////////////////////////////////////////////////////////////////////////////////////

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  output        = "../src/generated/prisma"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
  moduleFormat  = "esm"
}

enum UserRole {
  ADMIN
  OPERATIONS_MANAGER
  FINANCE_MANAGER
  CLIENT
  VIEWER
}

enum ClientType {
  COMPANY
  INDIVIDUAL
}

enum CargoType {
  GENERAL
  DANGEROUS
  PERISHABLE
  FRAGILE
  BULK
  CONTAINER
  PALLETIZED
  OTHER
}

enum TransportMode {
  ROAD
  SEA
  AIR
  RAIL
}

enum Priority {
  STANDARD
  EXPRESS
  URGENT
}

enum ShipmentStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  PICKED_UP
  IN_TRANSIT
  AT_CUSTOMS
  CUSTOMS_CLEARED
  OUT_FOR_DELIVERY
  READY_FOR_PICKUP
  DELIVERED
  CANCELLED
  ON_HOLD
  EXCEPTION
}

enum PickupStatus {
  NOUVEAU
  PRISE_EN_CHARGE
  EFFECTUE
  ANNULE
}

enum PickupTimeSlot {
  MORNING
  AFTERNOON
  EVENING
  SPECIFIC_TIME
  FLEXIBLE
}

enum PurchaseStatus {
  NOUVEAU
  EN_COURS
  LIVRE
  ANNULE
}

enum DeliveryMode {
  STANDARD
  EXPRESS
  URGENT
}

enum QuoteStatus {
  DRAFT
  SUBMITTED
  SENT
  ACCEPTED
  REJECTED
  EXPIRED
  IN_TREATMENT
  VALIDATED
  CANCELLED
}

enum QuotePaymentMethod {
  CASH
  ON_DELIVERY
  BANK_TRANSFER
}

enum ProspectStatus {
  PENDING
  CONVERTED
  EXPIRED
}

enum NotificationType {
  SHIPMENT_CREATED
  SHIPMENT_PICKED_UP
  SHIPMENT_IN_TRANSIT
  SHIPMENT_DELIVERED
  SHIPMENT_DELAYED
  INVOICE_GENERATED
  INVOICE_PAID
  QUOTE_REQUEST
  CUSTOMS_CLEARED
  DOCUMENT_UPLOADED
}

enum DocumentType {
  INVOICE_SCAN
  PROOF_OF_DELIVERY
  PROOF_OF_PICKUP
  PICKUP_SIGNATURE
  CUSTOMS_DOCUMENT
  PACKING_LIST
  BILL_OF_LADING
  CMR
  AIRWAY_BILL
  CERTIFICATE
  PHOTO
  OTHER
}

model User {
  id                        String            @id() @default(cuid())
  email                     String            @unique()
  emailVerified             Boolean           @default(false)
  name                      String?
  image                     String?
  phone                     String?
  createdAt                 DateTime          @default(now())
  updatedAt                 DateTime          @updatedAt()
  accounts                  Account[]
  sessions                  Session[]
  role                      UserRole          @default(CLIENT)
  clientId                  String?
  client                    Client?           @relation(fields: [clientId], references: [id], onDelete: Cascade)
  permissions               Json?
  createdShipments          Shipment[]        @relation("CreatedBy")
  userDocuments             Document[]        @relation("UserDocuments")
  uploadedDocuments         Document[]        @relation("UploadedDocuments")
  prospect                  Prospect?
  pricingConfigs            PricingConfig[]
  createdPickups            PickupRequest[]   @relation("CreatedPickups")
  pickupLogs                PickupLog[]       @relation("PickupLogChangedBy")
  userPickups               PickupRequest[]   @relation("UserPickups")
  createdPurchases          PurchaseRequest[] @relation("CreatedPurchases")
  purchaseLogs              PurchaseLog[]     @relation("PurchaseLogChangedBy")
  userPurchases             PurchaseRequest[] @relation("UserPurchases")
  quoteLogs                 QuoteLog[]        @relation("QuoteLogChangedBy")
  shipmentLogs              ShipmentLog[]     @relation("ShipmentLogChangedBy")
  treatedQuotes             Quote[]           @relation("QuoteTreatmentAgent")
  performedTrackingEvents   TrackingEvent[]   @relation("PerformedTrackingEvents")
  systemConfigUpdates       SystemConfig[]    @relation("SystemConfigUpdatedBy")
  userQuotes                Quote[]           @relation("UserQuotes")
  createdQuotes             Quote[]           @relation("CreatedQuotes")
  confirmedQuotePayments    Quote[]           @relation("QuotePaymentReceiver")
  confirmedShipmentPayments Shipment[]        @relation("ShipmentPaymentReceiver")

  @@index([clientId])
  @@map("user")
}

model Account {
  id                    String    @id() @default(cuid())
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt()

  @@unique([providerId, accountId])
  @@index([userId])
  @@map("account")
}

model Session {
  id        String   @id() @default(cuid())
  expiresAt DateTime
  token     String   @unique()
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("session")
}

model VerificationToken {
  identifier String
  token      String   @unique()
  expires    DateTime

  @@unique([identifier, token])
}

model Verification {
  id         String   @id() @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt()

  @@index([identifier])
  @@map("verification")
}

model Client {
  id               String            @id() @default(cuid())
  type             ClientType        @default(INDIVIDUAL)
  name             String
  email            String            @unique()
  phone            String?
  address          String
  city             String
  postalCode       String?
  country          String            @default("FR")
  legalName        String?
  taxId            String?           @unique()
  website          String?
  firstName        String?
  lastName         String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt()
  users            User[]
  shipments        Shipment[]
  quotes           Quote[]
  documents        Document[]
  pickupRequests   PickupRequest[]
  purchaseRequests PurchaseRequest[]

  @@index([taxId])
  @@index([email])
  @@index([type])
  @@map("Client")
}

model Shipment {
  id                    String          @id() @default(cuid())
  trackingNumber        String          @unique()
  clientId              String?
  client                Client?         @relation(fields: [clientId], references: [id])
  originAddress         String
  originCity            String
  originPostalCode      String
  originCountry         String
  originContact         String?
  originEmail           String?
  originPhone           String?
  destinationAddress    String
  destinationCity       String
  destinationPostalCode String
  destinationCountry    String
  destinationContact    String?
  destinationEmail      String?
  destinationPhone      String?
  cargoType             CargoType
  weight                Float
  length                Float?
  width                 Float?
  height                Float?
  packageCount          Int
  value                 Float?
  currency              String          @default("EUR")
  description           String
  specialInstructions   String?
  transportMode         TransportMode[]
  priority              Priority        @default(STANDARD)
  isDangerous           Boolean         @default(false)
  isFragile             Boolean         @default(false)
  requestedPickupDate   DateTime?
  actualPickupDate      DateTime?
  estimatedDeliveryDate DateTime?
  actualDeliveryDate    DateTime?
  status                ShipmentStatus  @default(DRAFT)
  estimatedCost         Float?
  actualCost            Float?
  paymentReceivedAt     DateTime?
  paymentReceivedById   String?
  paymentReceivedBy     User?           @relation("ShipmentPaymentReceiver", fields: [paymentReceivedById], references: [id])
  createdById           String
  createdBy             User            @relation("CreatedBy", fields: [createdById], references: [id])
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt()
  trackingEvents        TrackingEvent[]
  documents             Document[]
  pickupRequests        PickupRequest[]
  fromQuote             Quote?          @relation("QuoteToShipment")
  logs                  ShipmentLog[]

  @@index([clientId])
  @@index([trackingNumber])
  @@index([status])
  @@index([createdAt])
  @@index([originEmail])
  @@index([destinationEmail])
}

model PickupRequest {
  id                  String         @id() @default(cuid())
  trackingNumber      String         @unique()
  trackingToken       String         @unique() @default(cuid())
  tokenExpiresAt      DateTime
  userId              String?
  user                User?          @relation("UserPickups", fields: [userId], references: [id])
  isAttachedToAccount Boolean        @default(false)
  contactEmail        String
  contactPhone        String
  contactName         String?
  pickupAddress       String
  pickupCity          String
  pickupPostalCode    String
  pickupCountry       String         @default("FR")
  requestedDate       DateTime
  scheduledDate       DateTime?
  actualPickupDate    DateTime?
  timeSlot            PickupTimeSlot @default(FLEXIBLE)
  pickupTime          String?
  cargoType           String?
  estimatedWeight     Float?
  estimatedVolume     Float?
  packageCount        Int?
  description         String?        @db.Text()
  specialInstructions String?        @db.Text()
  accessInstructions  String?        @db.Text()
  internalNotes       String?        @db.Text()
  status              PickupStatus   @default(NOUVEAU)
  cancellationReason  String?        @db.Text()
  driverName          String?
  driverPhone         String?
  vehiclePlate        String?
  completionNotes     String?        @db.Text()
  shipmentId          String?
  shipment            Shipment?      @relation(fields: [shipmentId], references: [id], onDelete: Cascade)
  documents           Document[]
  logs                PickupLog[]
  clientId            String?
  client              Client?        @relation(fields: [clientId], references: [id])
  createdById         String?
  createdBy           User?          @relation("CreatedPickups", fields: [createdById], references: [id])
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt()

  @@index([trackingNumber])
  @@index([trackingToken])
  @@index([userId])
  @@index([contactEmail])
  @@index([contactPhone])
  @@index([status])
  @@index([clientId])
  @@index([shipmentId])
  @@index([createdAt])
  @@index([status, createdAt])
  @@map("pickup_request")
}

model PickupLog {
  id          String        @id() @default(cuid())
  pickupId    String
  pickup      PickupRequest @relation(fields: [pickupId], references: [id], onDelete: Cascade)
  oldStatus   PickupStatus?
  newStatus   PickupStatus?
  eventType   String
  changedById String?
  changedBy   User?         @relation("PickupLogChangedBy", fields: [changedById], references: [id])
  notes       String?       @db.Text()
  metadata    Json?
  createdAt   DateTime      @default(now())

  @@index([pickupId])
  @@index([createdAt])
  @@index([eventType])
  @@index([changedById])
  @@index([pickupId, createdAt])
  @@map("pickup_log")
}

model PurchaseRequest {
  id                  String         @id() @default(cuid())
  trackingNumber      String         @unique()
  trackingToken       String         @unique() @default(cuid())
  tokenExpiresAt      DateTime
  userId              String?
  user                User?          @relation("UserPurchases", fields: [userId], references: [id])
  isAttachedToAccount Boolean        @default(false)
  contactEmail        String
  contactPhone        String
  contactName         String?
  productName         String
  productUrl          String?        @db.Text()
  quantity            Int            @default(1)
  estimatedPrice      Float?
  maxBudget           Float?
  productDescription  String?        @db.Text()
  deliveryAddress     String
  deliveryCity        String
  deliveryPostalCode  String
  deliveryCountry     String         @default("FR")
  requestedDate       DateTime
  deliveryMode        DeliveryMode   @default(STANDARD)
  actualDeliveryDate  DateTime?
  specialInstructions String?        @db.Text()
  internalNotes       String?        @db.Text()
  status              PurchaseStatus @default(NOUVEAU)
  cancellationReason  String?        @db.Text()
  actualProductCost   Float?
  deliveryCost        Float?
  serviceFee          Float?
  totalCost           Float?
  purchaseProof       String?        @db.Text()
  completionNotes     String?        @db.Text()
  acceptedTerms       Boolean        @default(false)
  acceptedUrgentFee   Boolean        @default(false)
  acceptedPricing     Boolean        @default(false)
  documents           Document[]
  logs                PurchaseLog[]
  clientId            String?
  client              Client?        @relation(fields: [clientId], references: [id])
  createdById         String?
  createdBy           User?          @relation("CreatedPurchases", fields: [createdById], references: [id])
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt()

  @@index([trackingNumber])
  @@index([trackingToken])
  @@index([userId])
  @@index([contactEmail])
  @@index([contactPhone])
  @@index([status])
  @@index([clientId])
  @@index([createdAt])
  @@index([status, createdAt])
  @@map("purchase_request")
}

model PurchaseLog {
  id          String          @id() @default(cuid())
  purchaseId  String
  purchase    PurchaseRequest @relation(fields: [purchaseId], references: [id], onDelete: Cascade)
  oldStatus   PurchaseStatus?
  newStatus   PurchaseStatus?
  eventType   String
  changedById String?
  changedBy   User?           @relation("PurchaseLogChangedBy", fields: [changedById], references: [id])
  notes       String?         @db.Text()
  metadata    Json?
  createdAt   DateTime        @default(now())

  @@index([purchaseId])
  @@index([createdAt])
  @@index([eventType])
  @@index([changedById])
  @@index([purchaseId, createdAt])
  @@map("purchase_log")
}

model TrackingEvent {
  id            String         @id() @default(cuid())
  shipmentId    String
  shipment      Shipment       @relation(fields: [shipmentId], references: [id], onDelete: Cascade)
  status        ShipmentStatus
  location      String
  latitude      Float?
  longitude     Float?
  description   String?
  timestamp     DateTime       @default(now())
  metadata      Json?
  performedById String?
  performedBy   User?          @relation("PerformedTrackingEvents", fields: [performedById], references: [id])

  @@index([shipmentId])
  @@index([timestamp])
}

model ShipmentLog {
  id          String          @id() @default(cuid())
  shipmentId  String
  shipment    Shipment        @relation(fields: [shipmentId], references: [id], onDelete: Cascade)
  oldStatus   ShipmentStatus?
  newStatus   ShipmentStatus?
  eventType   String
  changedById String?
  changedBy   User?           @relation("ShipmentLogChangedBy", fields: [changedById], references: [id])
  notes       String?         @db.Text()
  metadata    Json?
  createdAt   DateTime        @default(now())

  @@index([shipmentId])
  @@index([eventType])
  @@index([createdAt])
  @@index([changedById])
  @@index([shipmentId, createdAt])
  @@map("shipment_log")
}

model Quote {
  id                      String              @id() @default(cuid())
  quoteNumber             String              @unique()
  trackingToken           String              @unique() @default(cuid())
  tokenExpiresAt          DateTime
  userId                  String?
  user                    User?               @relation("UserQuotes", fields: [userId], references: [id])
  isAttachedToAccount     Boolean             @default(false)
  contactEmail            String
  contactPhone            String?
  contactName             String?
  clientId                String?
  client                  Client?             @relation(fields: [clientId], references: [id])
  prospectId              String?
  prospect                Prospect?           @relation(fields: [prospectId], references: [id])
  originCountry           String
  destinationCountry      String
  transportMode           TransportMode[]
  cargoType               CargoType
  weight                  Float
  length                  Float?
  width                   Float?
  height                  Float?
  originAddress           String?
  originCity              String?
  originPostalCode        String?
  originContactName       String?
  originContactPhone      String?
  originContactEmail      String?
  destinationAddress      String?
  destinationCity         String?
  destinationPostalCode   String?
  destinationContactName  String?
  destinationContactPhone String?
  destinationContactEmail String?
  estimatedCost           Float
  validUntil              DateTime
  currency                String              @default("EUR")
  status                  QuoteStatus         @default(DRAFT)
  submittedAt             DateTime?
  acceptedAt              DateTime?
  rejectedAt              DateTime?
  paymentMethod           QuotePaymentMethod?
  agentComment            String?
  treatmentStartedAt      DateTime?
  treatmentValidatedAt    DateTime?
  treatmentAgentId        String?
  treatmentAgent          User?               @relation("QuoteTreatmentAgent", fields: [treatmentAgentId], references: [id])
  cancelledAt             DateTime?
  cancelReason            String?
  shipmentId              String?             @unique()
  shipment                Shipment?           @relation("QuoteToShipment", fields: [shipmentId], references: [id])
  paymentReceivedAt       DateTime?
  paymentReceivedById     String?
  paymentReceivedBy       User?               @relation("QuotePaymentReceiver", fields: [paymentReceivedById], references: [id])
  createdById             String?
  createdBy               User?               @relation("CreatedQuotes", fields: [createdById], references: [id])
  documents               Document[]
  logs                    QuoteLog[]
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @updatedAt()

  @@index([clientId])
  @@index([prospectId])
  @@index([status])
  @@index([trackingToken])
  @@index([contactEmail])
  @@index([userId])
  @@index([originContactEmail])
  @@index([destinationContactEmail])
  @@index([originCity])
  @@index([destinationCity])
}

model QuoteLog {
  id          String       @id() @default(cuid())
  quoteId     String
  quote       Quote        @relation(fields: [quoteId], references: [id], onDelete: Cascade)
  oldStatus   QuoteStatus?
  newStatus   QuoteStatus?
  eventType   String
  changedById String?
  changedBy   User?        @relation("QuoteLogChangedBy", fields: [changedById], references: [id])
  notes       String?      @db.Text()
  metadata    Json?
  createdAt   DateTime     @default(now())

  @@index([quoteId])
  @@index([eventType])
  @@index([createdAt])
  @@index([changedById])
  @@index([quoteId, createdAt])
  @@map("quote_log")
}

model Prospect {
  id                  String         @id() @default(cuid())
  email               String         @unique()
  phone               String?
  name                String?
  company             String?
  subject             String?
  invitationToken     String         @unique() @default(cuid())
  invitationExpiresAt DateTime
  status              ProspectStatus @default(PENDING)
  userId              String?        @unique()
  user                User?          @relation(fields: [userId], references: [id])
  quotes              Quote[]
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt()

  @@index([email])
  @@index([invitationToken])
  @@index([status])
}

model Notification {
  id        String           @id() @default(cuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  data      Json?
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())

  @@index([userId])
  @@index([isRead])
}

model Document {
  id                String           @id() @default(cuid())
  name              String
  fileUrl           String
  fileKey           String
  fileSize          Int
  mimeType          String
  type              DocumentType
  description       String?
  shipmentId        String?
  shipment          Shipment?        @relation(fields: [shipmentId], references: [id], onDelete: Cascade)
  quoteId           String?
  quote             Quote?           @relation(fields: [quoteId], references: [id], onDelete: Cascade)
  pickupRequestId   String?
  pickupRequest     PickupRequest?   @relation(fields: [pickupRequestId], references: [id], onDelete: Cascade)
  purchaseRequestId String?
  purchaseRequest   PurchaseRequest? @relation(fields: [purchaseRequestId], references: [id], onDelete: Cascade)
  clientId          String?
  client            Client?          @relation(fields: [clientId], references: [id])
  userId            String?
  user              User?            @relation("UserDocuments", fields: [userId], references: [id])
  uploadedBy        String
  uploader          User             @relation("UploadedDocuments", fields: [uploadedBy], references: [id])
  uploadedAt        DateTime         @default(now())

  @@index([clientId])
  @@index([userId])
  @@index([shipmentId])
  @@index([quoteId])
  @@index([pickupRequestId])
  @@index([purchaseRequestId])
  @@index([uploadedBy])
}

model PricingConfig {
  id                         String   @id() @default(cuid())
  baseRatePerKg              Float    @default(0.5)
  defaultRatePerKg           Float    @default(1.0)
  defaultRatePerM3           Float    @default(200.0)
  transportMultipliers       Json
  cargoTypeSurcharges        Json
  prioritySurcharges         Json
  deliverySpeedsPerMode      Json
  volumetricWeightRatios     Json     @default("{\"AIR\":167,\"ROAD\":333,\"SEA\":1,\"RAIL\":250}")
  useVolumetricWeightPerMode Json     @default("{\"AIR\":true,\"ROAD\":true,\"SEA\":false,\"RAIL\":true}")
  updatedById                String
  updatedBy                  User     @relation(fields: [updatedById], references: [id])
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt()

  @@map("pricing_config")
}

model CountryDistance {
  id                 String   @id() @default(cuid())
  originCountry      String
  destinationCountry String
  distanceKm         Int
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt()

  @@unique([originCountry, destinationCountry])
  @@index([originCountry])
  @@index([destinationCountry])
  @@map("country_distance")
}

model TransportRate {
  id                     String        @id() @default(cuid())
  originCountryCode      String
  destinationCountryCode String
  transportMode          TransportMode
  ratePerKg              Float
  ratePerM3              Float
  cargoTypeSurcharges    Json?
  prioritySurcharges     Json?
  isActive               Boolean       @default(true)
  notes                  String?
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt()

  @@unique([originCountryCode, destinationCountryCode, transportMode])
  @@index([originCountryCode])
  @@index([destinationCountryCode])
  @@index([transportMode])
  @@index([isActive])
  @@map("transport_rate")
}

model Country {
  id        String   @id() @default(cuid())
  code      String   @unique()
  name      String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()

  @@index([code])
  @@index([isActive])
  @@map("country")
}

model SystemConfig {
  id                  String   @id() @default(cuid())
  platformName        String   @default("Faso Fret")
  platformFullName    String   @default("Faso Fret Logistics")
  platformSlogan      String?  @default("Transport multi-modal international")
  contactEmail        String   @default("support@kmapin.com")
  contactPhone        String?
  logoUrl             String?
  faviconUrl          String?
  primaryColor        String   @default("#003D82")
  secondaryColor      String?  @default("#10B981")
  companyAddress      String?
  companyCity         String?
  companyCountry      String?  @default("Burkina Faso")
  companyPostalCode   String?
  facebookUrl         String?
  linkedinUrl         String?
  twitterUrl          String?
  instagramUrl        String?
  companyLegalName    String?  @default("Faso Fret Logistics SAS")
  companyRegistration String?
  vatNumber           String?
  copyrightYear       Int      @default(2025)
  updatedById         String
  updatedBy           User     @relation("SystemConfigUpdatedBy", fields: [updatedById], references: [id])
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt()

  @@map("system_config")
}
